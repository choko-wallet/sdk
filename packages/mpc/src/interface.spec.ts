// Copyright 2021-2022 @choko-wallet/mpc authors & contributors
// SPDX-License-Identifier: Apache-2.0

import { extractPublicKey, extractSignature, MpcRequest } from './interface';

describe('@choko-wallet/interface', () => {
  it('correctly parse mpc outputs - keygen', () => {
    const rawOutput = '{"paillier_dk":{"p":"163080661791033647795860899465771185566585213911431349795930649330293509320142493554165315328109564798978198525421164472697624441454948424991255803633058890871914054791386650704149571995249795440267113102081249247081447279796097343943263983904855598641984333709261568986051672656106997137324286456535332953359","q":"162079723201279511033893796119138893924287971260192014377718585234554445837949743083981669489543906405134373733578776471542151559374199506635158515408165251065200932536938272426828797360570098129946154030889481092106268159944385698575768184745742885120520484445862132226178439576547571912074807522266071640601"},"pk_vec":[{"curve":"secp256k1","point":"02fd306b75e22bba28d7372a0929221af700162d1dbbafccfe28e3f55aef41ee73"},{"curve":"secp256k1","point":"02f7b50ff15624332f56a625ce7d1d85f5aab96ead48117e54f8f4fcab037a0043"},{"curve":"secp256k1","point":"02a73e10ed6bc95e61636d18251f2434d0b9a86fb257018e91a111d3fe1bfbd743"}],"keys_linear":{"y":{"curve":"secp256k1","point":"0312d3afa5c7e893d9dddf478c49cb56a5bb9f4b1f8023a9d1fafe5de497c130a2"},"x_i":{"curve":"secp256k1","scalar":"477a56cdba3be3e3130028c25d054cc667b0932a3746dd42902f1d9d1a24bf93"}},"paillier_key_vec":[{"n":"26432068522572213382815754646559690160257714129017186806397481442338365539561626125371801398344795532540061044315946528749116710772160998286625733939749741005274194576197935602491864169056140624376759979316752006234389035022336617169027729102679454566939217602442534520571845261925806058011974474179175279992799782258860524137593386735810142681863372522995114984361303171511378510412012088197930743183936034823818569860845039115349244638283239621403366624978272829374686882168544106042083725513546086507664219559327175155870819380083339567364304280221307120595386800072073439065888486966446804945769283622007743728759"},{"n":"13962787250850892166967062449539139272045630068171253352061337912756661584888092590410839480951867202779709395405146727403084617327986802367912489606355359677267045784850353443010552657718568777761094219617216750462896014719058213269299362410543006427748528663823680622167467312726500678839585495751643290071560140621679108426990190031293091709841127786542612464356579565368502625588290851743043782835757268646949778657701803941732278738483306553715122828339641872915403804843300302787164146524544848858634219416835694261561960723908139533917638096292251418531132353412427551122597161962677849428893450186666952382993"},{"n":"17659038654696210523147455464271430070015024774706211024319566328620550038390170139738216664332799652085618241329315180978718641192258500685773906913947296937869092027556670858635947618745448976306864782626610120479179661916046535507891103028280110298519285152533687004664083746548886214973579008098611596546286217988989704893494780821144042335940412429865639989646733079955350651400083209122724170837798834684962566037113021446663789651114320795924544937330846017766601601605769369061635807759996930103637618850498443525606939590888907386453687944544782423683080349893907809785491485148172965295288104666922407074981"}],"y_sum_s":{"curve":"secp256k1","point":"0312d3afa5c7e893d9dddf478c49cb56a5bb9f4b1f8023a9d1fafe5de497c130a2"},"h1_h2_n_tilde_vec":[{"N":"6dc77fba084693dc6b0906d6fa1b8399a93292903367d94a8d61b08a3ece9ab28df44169d10239191c00bf46b471cf7f876a4246a3c9e0734724b2df6afca6073cb146de37796bcb5d16654eedb87c2fb6d535be8fcce02c899b420c231513f3bf96198183d7404321d574ccef43b9faf9f2dd54cab0c63b83112e05e50bcb6f4113134534650159ff4d708cd5f4f10bd5d892e99ef3e511865545542bb22059dfefe673c2157b474f8b98d0d7f393ce6867e1c86f676f7092a9142379705009781ec05fb6a26a3c765fef49f97cbf6f769c9d2cf305ce48cf2a3d1d547fdac548cebddc2cbee0de334e492431482ba310ec34e133cf3e7dbfb1b83258bee47d","g":"4c582efc54145af7c02498520766a819801a03f7334154234d494d9f8cc59a1b54d3b2a17c28eb85cab9ab7a6fc8ce3f03581191229ad3acea7bba72a698d6bfd5a4af6f2513bfd64ced599c8ede5aa9d22124624b4e2de57fddd325dbb0ae7df4d34204e759ffe1c25002185446f3faecdd4581bd6a0eca2d73d0bfb96909fc438f6cc0d5e5bd0bd5602d5498e376ef5230cbd17f84c65241d69a618cd3c150e755248cdad4e78424bc503f9f1d1cfbcf70656d4af4c024e4f00726e8f09080e51f512c5cfa8a8ce3a92faf1e5f943f17064c61e9e7ce6a2d524c3cedd3cc6d01f6928feecf9525da3eab3d6ce7adf37019777875929a5c73f9a110b1ec5d65","ni":"095b59327786b52ae18f3aa07afd739a93755b7809f0ef7acefc0b2ffd1cde9b4bee4c273c87711ec955a6a3b5d81e200ed0e9f9770950b006d57b6f94339b16ca0dbfe0e95de2335a9527504d5c771208525b08d50505b7c43a89b6385cc1a8933c47090c8245ca8cfcdefa6ba2025a846b403428e4ced7c7f30a94523656b2374168181636963a994039caca5e8145dbb4a6497b1344490f1547e9e2a07a13c018c58c5b2fba7d52e583a56918047c8fabaac095c282a70cb4e0eb1b102825b89aa5704f3df72b51eddcfbf88148f7717c88e80dea927520e195dfff2ab66c22481fd929c263f7689f52dac3370a753367f3c89413443e6a9a9b5d78ba6ca1"},{"N":"7f1c7c750035af1edb776a06e8192e17f70962ee29ce2b92fc15d5ce1f9ec869da2873d913011e8c588ee492c5cbc0ffcef399d3b552da55c067ac55f63a5bf1bc956918c7722c795773e16d2066a187a0481173ac8461d10db77e3e68cea33f4ecc5944c5f99230a246a7854e7badcad85f38df148ad8dfe6a1a7a2b9427ca0b718c26a11c8709fb22135a884d470c98d641aa35659c61fac69829b2060ac539aa66e8415514823fefc5eb1c3febf66832ea8fd52640a5086a37a2faaea7fa326a150a0265faeb813958c584f058acdc4de86eaeb41373501a16e89249ca4e21c5269694095deab02a9b75cbb382be45ad30d3a46300f8efeb75821b0a66d19","g":"7b7daa1bdec7327ffe4349a2cfd9afcf2280fb0ba7288cd548d286ba067e80c4d2633c436958d9fcc8a9959d8966b6a4da61b73a802ec0077d7f222eefd92ddbc603240bc2f25e94b176620a6b5fba69d52fd455e1c1c0ffa066b8832563c4322f45272a7406123dd719fc6e535d6284346a663e39b1609b22141f667d9cee3cf46de45d72e6b355e9cfc1a6dac8625bf97b3d0db880ca8a8c9564eaecfe3ed4c81a1763ffc0362f02cbe6bdd53a8a3ffc53d122d3421591444a1170cb1868be83c2fcf69a3c24afe39d9c4faa4b5f72524b132da67e422059eb543ea8f0b29b1dbdc4b225631d3f294d9bc96a16562ccad64832aed3e709ff6119c1bbc9d3fe","ni":"4f58dd647349cbfd78b3187256cfec399e85cfdd8334a5e67e9e1e900f771df143cb12e26cc59b3e2c0b8fc77ade5136567704f1d5f0265038225e2b2f6f4e37c554ac699132820a869b146562190e2f942fa1f25b9fbe688845e2d80172556ac4c047a9b4e5423ae00e57b6c306eb1a2a562366f054725d250264529149f6ca28875795ca9f99cd29fcca0bfd9c1debda3a70dc2f3b2f55130852c10dd52777556128fe4824120db4ff35fd7f57e37600ca9b6ca569194ed6d37ecb8639a8cfdda61e367d650d019ff6633040159a80b50967f49e0a20ce640bea02b36b613419c399b55e40fa4599bfd40a801b55cc85fee38c84efdc6678183d732d38db57"},{"N":"cabc634c54c55654e552aec244b12f486bd4deeddaa4e42738798b179d570a2b9a8f53f5b9744a2ebe6d65c7c4ed4da99a9221546d0cce3bb9dc3ee1597810cda2afffa69544158ef2d4d5f7a0caaae20269ab91d391102fc9e1d86f0293b03be9b0baaac4d51f54b9df554faa157e98d76faa6d2e2e32e8f0506d2aba8cde8c641871f8f38277c71f124e97fd35fe98c8a70790b8b64fc200b18ad6a2462e8c05aca157bc44391d68af4182e2a6749b39b70943376b8afb701b27b321b7da3cd7f06876c88dfc6eedeb364c00c17c7a444bca2708a7ab43ac0ef0d04bdd917074cdc842601ff92b467877add5a05b5b1eb6c0f92b2a6da9651d7fe5968df9b7","g":"5be017080c30546abf937ae69ac0239c2e393e9a6759ada405f4f2a68bd750697b96e3d4c49e0dc294b2f82971b17f3160a57fb18843718619fbb7901a2aa2429645a017a0cbafc19b817d3f5fba9bb0caa2dc42c414a617b2d0142b8d7e5a7780eda196a00ff35a396c97e2878ef56d48560255723e9a1ecdd77091c6ff0169e51c1b65d9cb005827132f13468efe60c4059d0b62c92dbd57d759e8da44e2a7191dac0bdc96c3634c83853457c58ac6d0f8aec98a76b4431e6ada7ef7c376fc53e209e4fac49bb31d8885596e3571bc3625e6984f8530e0e38069594aa4a261e527974200a3a287cbdf0609c38cc729f28a9564227cee03bb172aa86e755a7e","ni":"a515dc320c30ca06f49932b35a8d6843433546fc4610abff97da8be774f9997d3ce769de0fee4d0ff4a5b057e7f0ff651b25dc7fa8d4979bd737cc2a30f66afb24fd763c7be242dc794510c15deb7644288a33d2266c40a5f8fae3c8a884e2bd99ca818c8c5a2fe04285570f81a8578827d655a7898f92ddc9f302098d41839fb2d23df01dfd567f25ab892e8657381deda404de0665293862f6d81a1278761aeddbc65973124d4e0e772f95b00a0a8115c061e07801af176b1f3a7ff09edd753351151abb805e008928c0b3a5eddd168c10f0f53737416a3c0d345c4ee1c2df14101ae2c4b1a490013f05175fbc5bb827e40876dffd54d85d0fda85c1c01f67"}],"vss_scheme":{"parameters":{"threshold":1,"share_count":3},"commitments":[{"curve":"secp256k1","point":"0244bd77cd36446dd166fa234c043fe654ee062ed92294dbf146fba09a4b91e838"},{"curve":"secp256k1","point":"02652e68c1932cb2793a7acd87513db0120a1830e18197c60c104aa7617f29c167"}]},"i":1,"t":1,"n":3}';

    const pubKey = extractPublicKey(rawOutput);

    console.log(pubKey);
  });

  it('correctly parse mpc output - sign', () => {
    const rawOutput = '{"r":{"curve":"secp256k1","scalar":"c3b5f9835a4f07ab2e2cc8b0b682b342ff128dcf6c78bfff8c4485ee9d7566b8"},"s":{"curve":"secp256k1","scalar":"714ed634f1a3e6979fed940de05b24db05d35f67d11100bfd833ba52bfcd110b"},"recid":1}';
    const sig = extractSignature(rawOutput);

    console.log(sig);
  });

  it('correctly serialize mpc request - keygen', () => {
    const keygenRequst = MpcRequest.newKeyGenRequest(new Uint8Array(32));

    console.log('keygenRequst', keygenRequst);
    console.log('keygenRequst', keygenRequst.serialize());
  });

  it('correctly serialize mpc request - sign', () => {
    const signRequest = MpcRequest.newSignRequest(
      new Uint8Array(32), // payloadId
      new Uint8Array(32), // message
      new Uint8Array(32) // keygenId
    );

    console.log('signRequest', signRequest);
    console.log('signRequest', signRequest.serialize());
  });
});
